# Nginx Configuration for Redirect Domain
# This file redirects redirect-example.com to example.com while preserving query parameters
# 
# Setup:
# 1. Replace 'redirect-example.com' with your redirect domain
# 2. Replace 'example.com' with your destination domain
# 3. Copy to: /etc/nginx/sites-available/redirect-example.com
# 4. Enable: sudo ln -s /etc/nginx/sites-available/redirect-example.com /etc/nginx/sites-enabled/
# 5. Test: sudo nginx -t
# 6. Reload: sudo systemctl reload nginx

# HTTP to HTTPS redirect (after SSL setup)
server {
    listen 80;
    listen [::]:80;
    server_name redirect-example.com www.redirect-example.com;

    # Redirect to destination domain, preserving query parameters
    # $request_uri includes both path and query string
    return 301 https://example.com$request_uri;
}

# HTTPS redirect to destination domain
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name redirect-example.com www.redirect-example.com;

    # SSL certificates (get with: sudo certbot --nginx -d redirect-example.com)
    ssl_certificate /etc/letsencrypt/live/redirect-example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/redirect-example.com/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

    # Logging (optional)
    access_log /var/log/nginx/redirect-example.com-access.log;
    error_log /var/log/nginx/redirect-example.com-error.log;

    # Redirect to destination domain, preserving all query parameters
    # $request_uri = /evm?state=abc&id=xyz (includes path + query string)
    return 301 https://example.com$request_uri;
}

# IMPORTANT NOTES:
# 1. Replace 'redirect-example.com' with your actual redirect domain
# 2. Replace 'example.com' with your actual destination domain
# 3. Make sure both domains point to this server's IP
# 4. Get SSL certificates for both domains separately, or use a wildcard cert
# 5. The redirect preserves query parameters automatically via $request_uri

